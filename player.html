<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor HTML5 con VAST</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
        }
        #videoContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        #videoElement {
            width: 100%;
            height: 100%;
        }
        #adContainer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
        }
    </style>
</head>
<body>
    <div id="videoContainer">
        <video id="videoElement" controls playsinline>
            <source src="" type="video/mp4">
        </video>
        <div id="adContainer"></div>
    </div>

    <!-- IMA SDK -->
    <script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>

    <script>
        // Configuración
        const params = new URLSearchParams(window.location.search);
        const videoUrl = params.get('video') || 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4';
        const vastUrl = params.get('vast') || 'https://thusizulu.com/dOmJFdzyd.GwNqvRZEGDUF/zegm/9luEZwUklJkXP/TsY/xsNczMMI3uMJz/A/tjNSj/ER3/MbzHc-zcMCQY';

        // Elementos
        const videoElement = document.getElementById('videoElement');
        const adContainer = document.getElementById('adContainer');
        
        // Inicializar IMA
        const initIMA = () => {
            const adsLoader = new google.ima.AdsLoader(adContainer);
            const adsManager;
            
            // Configurar eventos
            adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, onAdsManagerLoaded);
            adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, onAdError);

            // Solicitar ads
            const adsRequest = new google.ima.AdsRequest();
            adsRequest.adTagUrl = vastUrl;
            adsRequest.linearAdSlotWidth = videoElement.offsetWidth;
            adsRequest.linearAdSlotHeight = videoElement.offsetHeight;
            adsLoader.requestAds(adsRequest);

            function onAdsManagerLoaded(event) {
                adsManager = event.getAdsManager(videoElement);
                adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, onAdError);
                adsManager.init(640, 360, google.ima.ViewMode.NORMAL);
                adsManager.start();
            }

            function onAdError(error) {
                console.error('Error de anuncio:', error.getError());
                adContainer.style.display = 'none';
                videoElement.play();
            }
        };

        // Cargar video principal
        videoElement.src = videoUrl;
        videoElement.load();
        
        // Iniciar todo cuando el video esté listo
        videoElement.addEventListener('loadedmetadata', () => {
            initIMA();
            videoElement.play().catch(error => {
                console.error('Error de autoplay:', error);
            });
        });

        // Manejar errores de video
        videoElement.addEventListener('error', () => {
            console.error('Error de video:', videoElement.error);
        });
    </script>
</body>
</html>
