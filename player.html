<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor Dinámico</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000; /* Fondo negro para evitar bordes blancos */
        }
        #video-container {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        video {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain; /* Asegura que el video mantenga sus proporciones */
        }
        .video-js {
            width: 100% !important;
            height: 100% !important;
        }
        /* Estilos específicos para Plyr */
        .plyr--full-ui {
            width: 100% !important;
            height: 100% !important;
        }
        .plyr__controls {
            opacity: 1 !important; /* Asegura que los controles sean visibles */
            visibility: visible !important;
        }
        .plyr__control {
            display: flex !important; /* Asegura que los botones sean visibles */
        }
    </style>
</head>
<body>
    <div id="video-container"></div>

    <script>
        // Obtener parámetros de la URL
        const params = new URLSearchParams(window.location.search);
        const videoUrl = params.get('video') || '';
        const posterUrl = params.get('poster') || '';
        const playerType = params.get('player') || 'videojs';

        const container = document.getElementById('video-container');

        // Función para cargar el reproductor seleccionado
        function loadPlayer() {
            if (!videoUrl) {
                console.error('No se proporcionó una URL de video.');
                return;
            }

            if (playerType === 'videojs') {
                loadVideoJS();
            } else if (playerType === 'plyr') {
                loadPlyr();
            } else {
                console.error('Tipo de reproductor no soportado.');
            }
        }

        // Cargar Video.js
        function loadVideoJS() {
            const script = document.createElement('script');
            script.src = 'https://vjs.zencdn.net/7.20.1/video.min.js';
            script.onload = () => {
                const link = document.createElement('link');
                link.href = 'https://vjs.zencdn.net/7.20.1/video-js.css';
                link.rel = 'stylesheet';
                document.head.appendChild(link);

                const videoElement = document.createElement('video');
                videoElement.id = 'myPlayer';
                videoElement.className = 'video-js vjs-default-skin vjs-big-play-centered'; // Centra el botón de reproducción
                videoElement.setAttribute('controls', '');
                videoElement.setAttribute('preload', 'auto'); // Precarga el video
                videoElement.setAttribute('playsinline', ''); // Importante para iOS
                videoElement.setAttribute('muted', ''); // Mudo por defecto para cumplir con Autoplay
                videoElement.setAttribute('poster', posterUrl);

                const source = document.createElement('source');
                source.src = videoUrl;
                source.type = 'video/mp4';
                videoElement.appendChild(source);

                container.appendChild(videoElement);

                const player = videojs('myPlayer', {
                    fluid: true, // Hace que el reproductor sea responsive
                    aspectRatio: '16:9', // Proporción de aspecto estándar
                    autoplay: true, // Intenta reproducir automáticamente
                    muted: true // Mudo por defecto para cumplir con Autoplay
                });

                // Detectar errores
                player.on('error', (error) => {
                    console.error('Error en Video.js:', error);
                });
            };
            document.body.appendChild(script);
        }

        // Cargar Plyr
        function loadPlyr() {
            const script = document.createElement('script');
            script.src = 'https://cdn.plyr.io/3.7.8/plyr.js';
            script.onload = () => {
                const link = document.createElement('link');
                link.href = 'https://cdn.plyr.io/3.7.8/plyr.css';
                link.rel = 'stylesheet';
                document.head.appendChild(link);

                const videoElement = document.createElement('video');
                videoElement.controls = true;
                videoElement.poster = posterUrl;

                const source = document.createElement('source');
                source.src = videoUrl;
                source.type = 'video/mp4';
                videoElement.appendChild(source);

                container.appendChild(videoElement);

                const player = new Plyr(videoElement, {
                    controls: [
                        'play',
                        'progress',
                        'current-time',
                        'mute',
                        'volume',
                        'fullscreen'
                    ], // Controles visibles
                    ratio: '16:9', // Proporción de aspecto estándar
                    loadSprite: true, // Habilita la carga de sprites CSS
                    blankVideo: 'https://cdn.plyr.io/static/blank.mp4', // Video en blanco para prevenir errores
                    autoplay: false, // Desactiva la reproducción automática
                    preload: 'auto', // Precarga el video
                    playsinline: true, // Importante para iOS
                    muted: true // Mudo por defecto para cumplir con Autoplay
                });

                // Detectar errores
                player.on('error', (event) => {
                    console.error('Error al cargar el video en Plyr:', event.detail);
                });

                // Forzar la carga rápida del video
                videoElement.preload = 'auto';
                videoElement.load();

                // Manejar interacción del usuario para activar audio
                videoElement.addEventListener('click', () => {
                    if (videoElement.muted) {
                        videoElement.muted = false; // Activar audio al hacer clic
                    }
                });
            };
            document.body.appendChild(script);
        }

        // Inicializar el reproductor
        loadPlayer();
    </script>
</body>
</html>
