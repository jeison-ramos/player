<script>
    const params = new URLSearchParams(window.location.search);
    const videoUrl = params.get('video');

    if (videoUrl) {
        // Configuración mejorada del reproductor
        const player = fluidPlayer("video-player", {
            layoutControls: {
                primaryColor: "#FF6600",
                playButtonShowing: true,
                autoPlay: true,  // Permitir autoplay para mejor transición
                mute: false,
                allowTheatre: true,
                controlBar: {
                    autoHide: true
                }
            },
            vastOptions: {
                adList: [
                    {
                        roll: "preRoll",
                        vastTag: "https://thusizulu.com/d.maFqzwdDGyNkvEZrG/UO/Re/md9YuiZMUplokQPVTwYox/NczUM_3LMpzaANtCN/jdEk3mMazec/ztM/SIZis/aGW/1/pZd/D/0kxF"
                    },
                    // ... (otros anuncios)
                ],
                skipButtonCaption: "Saltar en [[seconds]] segundos",
                skipButtonClickCaption: "Saltar ahora",
                adText: "Publicidad",
                adCTAText: "Más información"
            },
            // Añadir el video directamente en la configuración
            videoFile: videoUrl
        });

        // Manejar eventos clave
        player.on('ready', function() {
            console.log('Reproductor listo');
        });

        player.on('error', function(error) {
            console.error('Error del reproductor:', error);
        });

        // Manejar fin de anuncios
        player.on('adClick', function() {
            player.play();
        });

        player.on('adSkipped', function() {
            player.play();
        });

        player.on('adEnded', function() {
            player.play();
            // Forzar actualización de la interfaz
            player.refresh();
        });

        // Manejar posibles problemas de políticas de autoplay
        document.addEventListener('click', function() {
            player.play();
        });

    } else {
        document.getElementById('video-container').innerHTML = `
            <div style="color: white; text-align: center; font-size: 1.5em;">
                Error: No se proporcionó una URL de video. Usa el parámetro "video" en la URL.
            </div>
        `;
    }
</script>
