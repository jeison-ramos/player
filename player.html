<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Reproductor con Anuncio Personalizado (GIF)</title>
    <!-- Incluye Fluid Player -->
    <script src="https://cdn.fluidplayer.com/v3/current/fluidplayer.min.js"></script>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #000;
        }

        #video-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000;
        }

        #video-player {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            aspect-ratio: 16 / 9;
        }

        #ad-gif {
            max-width: 80%; /* El GIF no ocupará más del 80% del ancho del contenedor */
            max-height: 80%; /* El GIF no ocupará más del 80% del alto del contenedor */
            width: auto;
            height: auto;
            object-fit: contain;
        }

        #skip-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            z-index: 10;
        }

        #skip-button:hover {
            background-color: rgba(255, 0, 0, 0.7);
        }
    </style>
</head>
<body>
    <div id="video-container">
        <!-- Video principal -->
        <video id="video-player" controls style="display: none;">
            Tu navegador no soporta el elemento de video.
        </video>

        <!-- GIF de anuncio -->
        <img id="ad-gif" src="" alt="Anuncio" style="display: block;" />

        <!-- Botón de saltar -->
        <button id="skip-button" style="display: none;">Saltar en <span id="skip-timer">10</span>s</button>
    </div>

    <script>
        // Obtener parámetros de la URL
        const params = new URLSearchParams(window.location.search);
        const mainVideoUrl = params.get('video') || ''; // URL del video principal
        const posterUrl = params.get('poster') || ''; // URL de la imagen de portada

        // URL del GIF de anuncio y redirección
        const adGifUrl = 'https://imgs.search.brave.com/_8br6NuBuXDDAA0_Woy6dYe7rNTsdtT1L0AlnxBaxGA/rs:fit:860:0:0:0/g:ce/aHR0cHM6Ly9naWZk/Yi5jb20vaW1hZ2Vz/L2hpZ2gvc29sby1s/ZXZlbGluZy00OTgt/eC0yNzgtZ2lmLTF2/ZXptNjhwdXhnN2p2/c24uZ2lm.gif'; // Reemplaza con tu GIF de anuncio
        const redirectUrl = 'https://www.example.com'; // URL de redirección al hacer clic en "Saltar"

        // Elementos del DOM
        const videoPlayer = document.getElementById('video-player');
        const adGif = document.getElementById('ad-gif');
        const skipButton = document.getElementById('skip-button');
        const skipTimer = document.getElementById('skip-timer');

        let skipTimerCount = 10; // Tiempo inicial del contador
        let hasRedirected = false; // Bandera para verificar si ya se redirigió

        // Validar que el video principal esté presente
        if (!mainVideoUrl) {
            document.getElementById('video-container').innerHTML = `
                <div style="color: white; text-align: center; font-size: 1.5em;">
                    Error: No se proporcionó una URL válida para el video principal.
                </div>
            `;
        } else {
            // Configurar el video principal con Fluid Player
            fluidPlayer(
                'video-player', {
                    layoutControls: {
                        primaryColor: "#FF6600",
                        posterImage: posterUrl || null,
                        fillToContainer: true,
                        autoPlay: false,
                        allowTheatre: true,
                        allowFullScreen: true,
                        controlBar: {
                            autoHide: true,
                            autoHideTimeout: 3
                        }
                    }
                }
            );

            // Establecer la fuente del video principal
            videoPlayer.src = mainVideoUrl;

            // Configurar el GIF de anuncio
            adGif.src = adGifUrl;

            // Mostrar el botón de saltar después de cargar el GIF
            adGif.onload = () => {
                skipButton.style.display = 'block';
                startSkipTimer();
            };

            // Iniciar el contador del botón de saltar
            function startSkipTimer() {
                const timerInterval = setInterval(() => {
                    skipTimerCount--;
                    skipTimer.textContent = skipTimerCount;

                    if (skipTimerCount <= 0) {
                        clearInterval(timerInterval);
                        skipButton.textContent = 'Saltar ahora';
                        skipButton.disabled = false;
                    }
                }, 1000);
            }

            // Acción al hacer clic en el botón de saltar
            skipButton.addEventListener('click', () => {
                if (!hasRedirected) {
                    // Redirigir a la página externa
                    window.open(redirectUrl, '_blank');
                    hasRedirected = true; // Marcar como redirigido
                    skipButton.textContent = 'Saltar ahora';
                } else {
                    // Saltar el anuncio y mostrar el video principal
                    showMainVideo();
                }
            });

            // Mostrar el video principal y ocultar el GIF
            function showMainVideo() {
                adGif.style.display = 'none'; // Ocultar el GIF
                skipButton.style.display = 'none'; // Ocultar el botón de saltar
                videoPlayer.style.display = 'block'; // Mostrar el video principal
                videoPlayer.play(); // Reproducir el video principal
            }
        }
    </script>
</body>
</html>
